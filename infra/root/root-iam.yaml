AWSTemplateFormatVersion: 2010-09-09

Description: >
  Specifies which resources we would like this project to access
  in our root account.
  The root account is where the domain has been purchased from
  and also where it needs to be configured from.
  This template sets up cross account access to this root account.

Parameters:
  Project:
    Type: String
    Description: "Project name in Pascal case"
  HostedZoneId:
    Type: String
  AccountId:
    Type: String

Resources:
  BasePolicy:
    Type: AWS::IAM::Policy
    Properties:
      Roles:
        - !Ref BaseRole
      PolicyName: BasePolicy
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Resource: !Sub arn:aws:route53:::hostedzone/${HostedZoneId}
            Action: route53:*
          - Effect: Allow
            Resource: '*'
            Action:
              - route53:List*
              - route53:Get*
          - Effect: Allow
            Resource: '*'
            Action:
              - cloudformation:Describe*
              - cloudformation:List*
              - cloudformation:Get*
              - cloudformation:Create*
              - cloudformation:Update*
              - cloudformation:DeleteStack
          - Effect: Allow
            Resource: '*'
            Action:
              - ses:List*
              - ses:GetIdentity*

  BaseRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub ${Project}Base
      MaxSessionDuration: 43200
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              AWS: !Sub arn:aws:iam::${AccountId}:user/admin
            Action: sts:AssumeRole
